<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>vCard Master Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet"/>
<style>
:root{--bg:#0d0f14;--surface:#151820;--surface2:#1c2030;--border:#252a3a;--accent:#5b8cff;--accent2:#ff6b6b;--accent3:#00e5a0;--text:#e8eaf0;--text2:#8b90a8;--text3:#545870;--radius:12px;--sidebar:265px;}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;overflow-x:hidden;}
#login-screen{position:fixed;inset:0;background:var(--bg);display:flex;align-items:center;justify-content:center;z-index:1000;transition:opacity .4s;}
#login-screen.hidden{opacity:0;pointer-events:none;}
.login-box{background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:48px 40px;width:400px;text-align:center;}
.login-logo{width:56px;height:56px;background:linear-gradient(135deg,var(--accent),#a78bff);border-radius:14px;display:flex;align-items:center;justify-content:center;margin:0 auto 20px;font-size:24px;}
.login-box h1{font-family:'Syne',sans-serif;font-size:26px;font-weight:800;margin-bottom:6px;}
.login-box p{color:var(--text2);font-size:13px;margin-bottom:32px;}
.input-group{text-align:left;margin-bottom:16px;}
.input-group label{font-size:11px;color:var(--text2);font-weight:500;text-transform:uppercase;letter-spacing:.8px;display:block;margin-bottom:6px;font-family:'DM Mono',monospace;}
.input-group input{width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:11px 14px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;outline:none;transition:border-color .2s;}
.input-group input:focus{border-color:var(--accent);}
.btn-login{width:100%;background:var(--accent);border:none;border-radius:8px;padding:13px;color:#fff;font-family:'Syne',sans-serif;font-weight:700;font-size:15px;cursor:pointer;margin-top:8px;}
.login-hint{color:var(--text3);font-size:12px;margin-top:16px;}
.sidebar{width:var(--sidebar);background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;position:fixed;top:0;left:0;height:100vh;z-index:100;}
.sidebar-header{padding:24px 20px;border-bottom:1px solid var(--border);}
.sidebar-logo{display:flex;align-items:center;gap:10px;}
.logo-icon{width:36px;height:36px;background:linear-gradient(135deg,var(--accent),#a78bff);border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:17px;flex-shrink:0;}
.sidebar-logo .brand{font-family:'Syne',sans-serif;font-weight:800;font-size:16px;}
.sidebar-logo small{display:block;font-size:11px;color:var(--text3);font-family:'DM Mono',monospace;}
.sidebar-nav{flex:1;overflow-y:auto;padding:12px 0;}
.nav-section{padding:6px 20px;font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:1.2px;font-weight:600;font-family:'DM Mono',monospace;margin-top:8px;}
.nav-item{display:flex;align-items:center;gap:11px;padding:10px 20px;cursor:pointer;transition:background .15s;color:var(--text2);font-size:14px;font-weight:500;position:relative;margin:1px 0;}
.nav-item:hover{background:var(--surface2);color:var(--text);}
.nav-item.active{background:rgba(91,140,255,.12);color:var(--accent);}
.nav-item.active::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--accent);border-radius:0 2px 2px 0;}
.nav-item .icon{width:30px;height:30px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:14px;background:var(--surface2);flex-shrink:0;}
.nav-item.active .icon{background:rgba(91,140,255,.2);}
.sidebar-footer{padding:14px 20px;border-top:1px solid var(--border);}
.logout-btn{display:flex;align-items:center;gap:10px;color:var(--text2);font-size:13px;cursor:pointer;padding:8px 12px;border-radius:8px;transition:all .15s;}
.logout-btn:hover{background:rgba(255,107,107,.1);color:var(--accent2);}
.main{margin-left:var(--sidebar);flex:1;display:flex;flex-direction:column;min-height:100vh;}
.topbar{background:var(--surface);border-bottom:1px solid var(--border);padding:16px 32px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50;}
.page-title{font-family:'Syne',sans-serif;font-weight:700;font-size:18px;}
.topbar-right{display:flex;align-items:center;gap:12px;}
.live-badge{background:rgba(0,229,160,.12);color:var(--accent3);border-radius:20px;padding:4px 12px;font-size:12px;font-weight:600;font-family:'DM Mono',monospace;display:flex;align-items:center;gap:6px;}
.live-dot{width:7px;height:7px;border-radius:50%;background:var(--accent3);animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:.4;}}
.preview-btn{background:var(--accent);color:#fff;border:none;border-radius:8px;padding:8px 16px;font-size:13px;font-weight:600;cursor:pointer;font-family:'Syne',sans-serif;display:inline-flex;align-items:center;gap:6px;text-decoration:none;}
.content{padding:32px;flex:1;}
.section-panel{display:none;}.section-panel.active{display:block;}
.stat-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(155px,1fr));gap:16px;margin-bottom:28px;}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px;}
.stat-card .lbl{font-size:11px;color:var(--text2);text-transform:uppercase;letter-spacing:.8px;font-family:'DM Mono',monospace;margin-bottom:8px;}
.stat-card .val{font-family:'Syne',sans-serif;font-size:28px;font-weight:800;}
.stat-card .sub{font-size:12px;color:var(--text3);margin-top:4px;}
.stat-card.blue .val{color:var(--accent);}.stat-card.green .val{color:var(--accent3);}.stat-card.yellow .val{color:#ffc046;}.stat-card.red .val{color:var(--accent2);}
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:24px;margin-bottom:20px;}
.card-title{font-family:'Syne',sans-serif;font-weight:700;font-size:15px;margin-bottom:20px;display:flex;align-items:center;gap:10px;}
.dot{width:8px;height:8px;border-radius:50%;background:var(--accent);flex-shrink:0;}
.dot-green{background:var(--accent3);}.dot-red{background:var(--accent2);}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.form-grid.full{grid-template-columns:1fr;}
.field{display:flex;flex-direction:column;gap:6px;}
.field label{font-size:11px;color:var(--text2);font-weight:500;text-transform:uppercase;letter-spacing:.7px;font-family:'DM Mono',monospace;}
.field input,.field textarea,.field select{background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:10px 14px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;outline:none;transition:border-color .2s;resize:vertical;width:100%;}
.field input:focus,.field textarea:focus,.field select:focus{border-color:var(--accent);}
.field textarea{min-height:100px;}
.btn{border:none;border-radius:8px;padding:10px 20px;font-family:'Syne',sans-serif;font-weight:700;font-size:14px;cursor:pointer;transition:opacity .2s;display:inline-flex;align-items:center;gap:7px;}
.btn:hover{opacity:.85;}
.btn-primary{background:var(--accent);color:#fff;}.btn-success{background:var(--accent3);color:#000;}.btn-danger{background:var(--accent2);color:#fff;}.btn-ghost{background:var(--surface2);color:var(--text2);border:1px solid var(--border);}
.btn-sm{padding:7px 14px;font-size:12px;}
.actions{display:flex;gap:10px;margin-top:20px;flex-wrap:wrap;}
.sec-header{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:24px;gap:16px;}
.sec-header h2{font-family:'Syne',sans-serif;font-weight:800;font-size:20px;}
.sec-header p{font-size:13px;color:var(--text3);margin-top:4px;}
.items-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:14px;margin-top:4px;}
.item-card{background:var(--surface2);border:1px solid var(--border);border-radius:10px;overflow:hidden;}
.item-img-wrap{width:100%;height:120px;background:linear-gradient(135deg,#1c2236,#252a3a);display:flex;align-items:center;justify-content:center;font-size:30px;color:var(--text3);overflow:hidden;}
.item-img-wrap img{width:100%;height:100%;object-fit:cover;display:block;}
.item-body{padding:12px;}
.item-title{font-weight:600;font-size:14px;margin-bottom:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.item-btns{display:flex;gap:6px;}
.del-btn{background:rgba(255,107,107,.12);color:var(--accent2);border:none;border-radius:6px;padding:5px 10px;font-size:12px;cursor:pointer;font-family:'DM Mono',monospace;}
.del-btn:hover{background:rgba(255,107,107,.25);}
.edit-btn{background:rgba(91,140,255,.12);color:var(--accent);border:none;border-radius:6px;padding:5px 10px;font-size:12px;cursor:pointer;font-family:'DM Mono',monospace;}
.edit-btn:hover{background:rgba(91,140,255,.25);}
.add-card{background:var(--surface2);border:2px dashed var(--border);border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;min-height:190px;cursor:pointer;color:var(--text3);transition:all .2s;font-size:13px;}
.add-card:hover{border-color:var(--accent);color:var(--accent);}
.add-card .plus{font-size:28px;line-height:1;}
.social-row{display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--border);}
.social-row:last-child{border-bottom:none;}
.social-icon{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;}
.si-fb{background:rgba(24,119,242,.15);color:#1877f2;}.si-ig{background:rgba(225,48,108,.15);color:#e1306c;}.si-yt{background:rgba(255,0,0,.15);color:#ff0000;}.si-tw{background:rgba(29,161,242,.15);color:#1da1f2;}.si-li{background:rgba(0,119,181,.15);color:#0077b5;}.si-gp{background:rgba(219,68,55,.15);color:#db4437;}
.social-name{width:90px;font-size:13px;color:var(--text2);flex-shrink:0;}
.social-row input{flex:1;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:9px 12px;color:var(--text);font-family:'DM Mono',monospace;font-size:12px;outline:none;transition:border-color .2s;}
.social-row input:focus{border-color:var(--accent);}
.eq-table{width:100%;border-collapse:collapse;font-size:13px;}
.eq-table th{padding:10px 14px;text-align:left;font-size:11px;color:var(--text3);text-transform:uppercase;letter-spacing:.8px;font-family:'DM Mono',monospace;border-bottom:1px solid var(--border);}
.eq-table td{padding:12px 14px;border-bottom:1px solid rgba(255,255,255,.04);vertical-align:top;}
.eq-table tr:hover td{background:rgba(255,255,255,.02);}
.s-new{background:rgba(0,229,160,.1);color:var(--accent3);border-radius:20px;padding:3px 10px;font-size:11px;font-weight:600;font-family:'DM Mono';}
.s-read{background:rgba(139,144,168,.1);color:var(--text3);border-radius:20px;padding:3px 10px;font-size:11px;font-weight:600;font-family:'DM Mono';}
.toggle-row{display:flex;align-items:center;justify-content:space-between;padding:14px 0;border-bottom:1px solid var(--border);}
.toggle-row:last-child{border-bottom:none;}
.ti h4{font-size:14px;font-weight:500;margin-bottom:3px;}.ti p{font-size:12px;color:var(--text3);}
.toggle{position:relative;width:42px;height:24px;flex-shrink:0;}
.toggle input{opacity:0;width:0;height:0;}
.slider{position:absolute;inset:0;background:var(--surface2);border:1px solid var(--border);border-radius:24px;cursor:pointer;transition:.3s;}
.slider::before{content:'';position:absolute;height:16px;width:16px;left:3px;bottom:3px;background:var(--text3);border-radius:50%;transition:.3s;}
.toggle input:checked+.slider{background:var(--accent);border-color:var(--accent);}
.toggle input:checked+.slider::before{transform:translateX(18px);background:#fff;}
.color-row{display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--border);}
.color-row:last-child{border-bottom:none;}
.color-row label{flex:1;font-size:13px;font-weight:500;}
.color-row input[type=color]{width:42px;height:34px;border:none;border-radius:6px;background:transparent;cursor:pointer;padding:2px;}
.modal-ov{position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:200;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .2s;}
.modal-ov.show{opacity:1;pointer-events:all;}
.modal-box{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:28px;width:500px;max-width:95vw;max-height:90vh;overflow-y:auto;transform:translateY(20px);transition:transform .2s;}
.modal-ov.show .modal-box{transform:translateY(0);}
.modal-title{font-family:'Syne',sans-serif;font-weight:700;font-size:18px;margin-bottom:20px;}
.modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:20px;}
.toast{position:fixed;bottom:24px;right:24px;background:var(--surface);border:1px solid var(--accent3);border-radius:10px;padding:12px 20px;font-size:13px;font-weight:500;display:flex;align-items:center;gap:10px;z-index:999;transform:translateY(80px);opacity:0;transition:all .3s;}
.toast.show{transform:translateY(0);opacity:1;}
.toast-dot{width:8px;height:8px;border-radius:50%;background:var(--accent3);flex-shrink:0;}
.chart-bars{display:flex;align-items:flex-end;gap:5px;height:64px;margin-top:14px;}
.chart-bar{flex:1;border-radius:4px 4px 0 0;background:linear-gradient(to top,var(--accent),#a78bff);opacity:.7;min-height:4px;}
.chart-labels{display:flex;justify-content:space-between;margin-top:6px;font-size:11px;color:var(--text3);font-family:'DM Mono';}
.tpl-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:16px;}
.tpl-card{background:var(--surface2);border:2px solid var(--border);border-radius:14px;overflow:hidden;cursor:pointer;transition:all .2s;position:relative;}
.tpl-card:hover{border-color:var(--accent);transform:translateY(-2px);box-shadow:0 8px 24px rgba(91,140,255,.15);}
.tpl-card.selected{border-color:var(--accent3);box-shadow:0 8px 24px rgba(0,229,160,.15);}
.tpl-card.selected::after{content:'‚úì ACTIVE';position:absolute;top:8px;right:8px;background:var(--accent3);color:#000;font-size:10px;font-weight:700;font-family:'DM Mono',monospace;padding:3px 8px;border-radius:20px;letter-spacing:.5px;}
.tpl-preview{height:140px;display:flex;align-items:center;justify-content:center;font-size:50px;position:relative;overflow:hidden;}
.tpl-info{padding:12px;}
.tpl-name{font-family:'Syne',sans-serif;font-weight:700;font-size:14px;margin-bottom:4px;}
.tpl-desc{font-size:11px;color:var(--text3);line-height:1.5;}
.tpl-tags{display:flex;flex-wrap:wrap;gap:4px;margin-top:8px;}
.tpl-tag{background:rgba(91,140,255,.1);color:var(--accent);border-radius:4px;padding:2px 8px;font-size:10px;font-family:'DM Mono',monospace;}
.upload-area{border:2px dashed var(--border);border-radius:10px;padding:18px 16px;text-align:center;cursor:pointer;transition:all .2s;position:relative;overflow:hidden;}
.upload-area:hover{border-color:var(--accent);background:rgba(91,140,255,.04);}
.upload-area input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
.upload-label{font-size:12px;color:var(--text3);margin-top:6px;}
.upload-icon{font-size:26px;}
.upload-preview{width:100%;height:100px;object-fit:cover;border-radius:8px;margin-top:10px;display:none;}
.upload-preview.show{display:block;}
.custom-sec-card{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:16px;margin-bottom:12px;display:flex;align-items:center;gap:14px;}
.custom-sec-num{width:34px;height:34px;background:rgba(91,140,255,.15);color:var(--accent);border-radius:8px;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:800;font-size:14px;flex-shrink:0;}
.custom-sec-info{flex:1;min-width:0;}
.custom-sec-title{font-weight:600;font-size:14px;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.custom-sec-preview{font-size:12px;color:var(--text3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
::-webkit-scrollbar{width:5px;}::-webkit-scrollbar-track{background:transparent;}::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-logo">‚ö°</div>
    <h1>Master Admin</h1>
    <p>vCard Multi-Template System</p>
    <div class="input-group"><label>Username</label><input type="text" id="lu" placeholder="admin"/></div>
    <div class="input-group"><label>Password</label><input type="password" id="lp" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/></div>
    <button class="btn-login" onclick="doLogin()">Sign In ‚Üí</button>
    <p class="login-hint">Default: admin / admin123</p>
  </div>
</div>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-header">
    <div class="sidebar-logo">
      <div class="logo-icon">‚ö°</div>
      <div><div class="brand">vCard Admin</div><small>Master Panel</small></div>
    </div>
  </div>
  <nav class="sidebar-nav">
    <div class="nav-section">Dashboard</div>
    <div class="nav-item active" data-panel="dashboard"><div class="icon">üìä</div>Overview</div>
    <div class="nav-section">üé® Templates</div>
    <div class="nav-item" data-panel="templates"><div class="icon">üé®</div>Choose Template</div>
    <div class="nav-section">Content</div>
    <div class="nav-item" data-panel="profile"><div class="icon">üë§</div>Profile & Home</div>
    <div class="nav-item" data-panel="about"><div class="icon">üìÑ</div>About Us</div>
    <div class="nav-item" data-panel="services"><div class="icon">üõçÔ∏è</div>Services</div>
    <div class="nav-item" data-panel="gallery"><div class="icon">üñºÔ∏è</div>Gallery</div>
    <div class="nav-item" data-panel="videos"><div class="icon">üé¨</div>Videos</div>
    <div class="nav-item" data-panel="payment"><div class="icon">üí≥</div>Payment</div>
    <div class="nav-item" data-panel="products"><div class="icon">üõí</div>Products Shop</div>
    <div class="nav-item" data-panel="custom-sections"><div class="icon">‚ûï</div>Custom Sections</div>
    <div class="nav-item" data-panel="social"><div class="icon">üîó</div>Social Links</div>
    <div class="nav-section">Messages</div>
    <div class="nav-item" data-panel="enquiries">
      <div class="icon">üì¨</div>Enquiries
      <span id="eq-badge" style="margin-left:auto;background:var(--accent2);color:#fff;border-radius:10px;padding:1px 7px;font-size:11px;font-family:'DM Mono';font-weight:600;display:none;"></span>
    </div>
    <div class="nav-section">Configuration</div>
    <div class="nav-item" data-panel="appearance"><div class="icon">üé®</div>Appearance</div>
    <div class="nav-item" data-panel="settings"><div class="icon">‚öôÔ∏è</div>Settings</div>
  </nav>
  <div class="sidebar-footer">
    <div class="logout-btn" onclick="doLogout()">üö™ Logout</div>
  </div>
</aside>

<!-- MAIN -->
<div class="main">
  <div class="topbar">
    <div class="page-title" id="page-title">Dashboard Overview</div>
    <div class="topbar-right">
      <span class="live-badge"><span class="live-dot"></span>Live Site</span>
      <a class="preview-btn" id="preview-link" href="template-luxury.html" target="_blank">üëÅ View Site</a>
    </div>
  </div>
  <div class="content">

    <!-- DASHBOARD -->
    <div class="section-panel active" id="panel-dashboard">
      <div class="stat-grid">
        <div class="stat-card blue"><div class="lbl">Views</div><div class="val" id="d-views">-</div><div class="sub">All time</div></div>
        <div class="stat-card green"><div class="lbl">Enquiries</div><div class="val" id="d-enq">0</div><div class="sub">Messages</div></div>
        <div class="stat-card yellow"><div class="lbl">Services</div><div class="val" id="d-svc">0</div><div class="sub">Active</div></div>
        <div class="stat-card red"><div class="lbl">Gallery</div><div class="val" id="d-gal">0</div><div class="sub">Images</div></div>
        <div class="stat-card blue"><div class="lbl">Products</div><div class="val" id="d-prod">0</div><div class="sub">Shop items</div></div>
        <div class="stat-card green"><div class="lbl">Sections</div><div class="val" id="d-cs">0</div><div class="sub">Custom</div></div>
      </div>
      <div style="display:grid;grid-template-columns:2fr 1fr;gap:20px;">
        <div class="card">
          <div class="card-title"><span class="dot"></span>Weekly Views</div>
          <div class="chart-bars" id="chart-bars"></div>
          <div class="chart-labels"><span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span><span>Sun</span></div>
        </div>
        <div class="card">
          <div class="card-title"><span class="dot dot-green"></span>Active Template</div>
          <div id="dash-template-info" style="font-size:13px;color:var(--text2);line-height:2.2;"></div>
        </div>
      </div>
    </div>

    <!-- TEMPLATES -->
    <div class="section-panel" id="panel-templates">
      <div class="sec-header"><div><h2>Choose Template</h2><p>Select a design ‚Äî all templates share your data.</p></div></div>
      <div class="tpl-grid" id="tpl-grid"></div>
    </div>

    <!-- PROFILE -->
    <div class="section-panel" id="panel-profile">
      <div class="sec-header"><div><h2>Profile & Home</h2><p>Business details shown on the Home section</p></div><button class="btn btn-primary" onclick="saveSection('profile')">üíæ Save Changes</button></div>
      <div class="card">
        <div class="card-title"><span class="dot"></span>Business Information</div>
        <div class="form-grid">
          <div class="field"><label>Business Name</label><input id="f-businessName" type="text"/></div>
          <div class="field"><label>Owner Name</label><input id="f-ownerName" type="text"/></div>
          <div class="field"><label>Business Position</label><input id="f-bizPosition" type="text"/></div>
          <div class="field"><label>Person Type / Tagline</label><input id="f-personType" type="text"/></div>
        </div>
      </div>
      <div class="card">
        <div class="card-title"><span class="dot"></span>Contact Details</div>
        <div class="form-grid">
          <div class="field"><label>Phone</label><input id="f-phone" type="text"/></div>
          <div class="field"><label>Email</label><input id="f-email" type="email"/></div>
          <div class="field"><label>Fax / WhatsApp</label><input id="f-fax" type="text"/></div>
          <div class="field"><label>Website URL</label><input id="f-websiteUrl" type="url"/></div>
          <div class="field" style="grid-column:1/-1"><label>Address</label><input id="f-address" type="text"/></div>
          <div class="field"><label>Google Maps URL</label><input id="f-mapsUrl" type="url"/></div>
          <div class="field"><label>WhatsApp Share URL</label><input id="f-whatsappShareUrl" type="url"/></div>
        </div>
      </div>
      <div class="card">
        <div class="card-title"><span class="dot"></span>Profile Image</div>
        <div class="form-grid">
          <div class="field"><label>Image URL / Path</label><input id="f-profileImg" type="text" placeholder="assets/images/profile.png"/></div>
          <div class="field"><label>üìÅ Upload Image</label>
            <div class="upload-area">
              <div class="upload-icon">üì∏</div><div class="upload-label">Click to upload (max 5MB)</div>
              <input type="file" accept="image/*" onchange="handleImgUpload(this,'f-profileImg','profile-preview')"/>
            </div>
            <img id="profile-preview" class="upload-preview" src="" alt=""/>
          </div>
        </div>
      </div>
      <div class="actions"><button class="btn btn-primary" onclick="saveSection('profile')">üíæ Save Profile</button></div>
    </div>

    <!-- ABOUT -->
    <div class="section-panel" id="panel-about">
      <div class="sec-header"><div><h2>About Us</h2><p>Edit the About section content</p></div><button class="btn btn-primary" onclick="saveSection('about')">üíæ Save</button></div>
      <div class="card">
        <div class="card-title"><span class="dot"></span>Section Heading</div>
        <div class="form-grid">
          <div class="field"><label>Title</label><input id="f-aboutTitle" type="text"/></div>
          <div class="field"><label>Subtitle</label><input id="f-aboutSubtitle" type="text"/></div>
        </div>
      </div>
      <div class="card">
        <div class="card-title"><span class="dot"></span>Content</div>
        <div class="form-grid full">
          <div class="field"><label>Paragraph 1</label><textarea id="f-aboutPara1"></textarea></div>
          <div class="field"><label>Paragraph 2</label><textarea id="f-aboutPara2"></textarea></div>
        </div>
      </div>
      <div class="actions"><button class="btn btn-primary" onclick="saveSection('about')">üíæ Save About</button></div>
    </div>

    <!-- SERVICES -->
    <div class="section-panel" id="panel-services">
      <div class="sec-header"><div><h2>Services</h2><p>Manage service cards</p></div><button class="btn btn-primary" onclick="openItemModal('services',-1)">+ Add Service</button></div>
      <div class="card">
        <div class="card-title"><span class="dot"></span>Section Heading</div>
        <div class="form-grid">
          <div class="field"><label>Title</label><input id="f-serviceTitle" type="text"/></div>
          <div class="field"><label>Subtitle</label><input id="f-serviceSubtitle" type="text"/></div>
        </div>
        <div class="actions"><button class="btn btn-ghost btn-sm" onclick="saveHeading('serviceTitle','serviceSubtitle')">üíæ Save Heading</button></div>
      </div>
      <div class="card"><div class="card-title"><span class="dot"></span>Service Items</div><div class="items-grid" id="services-grid"></div></div>
    </div>

    <!-- GALLERY -->
    <div class="section-panel" id="panel-gallery">
      <div class="sec-header"><div><h2>Gallery</h2><p>Manage gallery images</p></div><button class="btn btn-primary" onclick="openItemModal('gallery',-1)">+ Add Image</button></div>
      <div class="card">
        <div class="card-title"><span class="dot"></span>Section Heading</div>
        <div class="form-grid">
          <div class="field"><label>Title</label><input id="f-galleryTitle" type="text"/></div>
          <div class="field"><label>Subtitle</label><input id="f-gallerySubtitle" type="text"/></div>
        </div>
        <div class="actions"><button class="btn btn-ghost btn-sm" onclick="saveHeading('galleryTitle','gallerySubtitle')">üíæ Save Heading</button></div>
      </div>
      <div class="card"><div class="card-title"><span class="dot"></span>Gallery Images</div><div class="items-grid" id="gallery-grid"></div></div>
    </div>

    <!-- VIDEOS -->
    <div class="section-panel" id="panel-videos">
      <div class="sec-header"><div><h2>Videos</h2><p>YouTube embeds or local uploads</p></div><button class="btn btn-primary" onclick="openVideoModal(-1)">+ Add Video</button></div>
      <div class="card">
        <div class="card-title"><span class="dot"></span>Section Heading</div>
        <div class="form-grid">
          <div class="field"><label>Title</label><input id="f-videoTitle" type="text"/></div>
          <div class="field"><label>Subtitle</label><input id="f-videoSubtitle" type="text"/></div>
        </div>
        <div class="actions"><button class="btn btn-ghost btn-sm" onclick="saveHeading('videoTitle','videoSubtitle')">üíæ Save Heading</button></div>
      </div>
      <div class="card"><div class="card-title"><span class="dot"></span>Videos</div><div id="videos-list"></div></div>
    </div>

    <!-- PAYMENT -->
    <div class="section-panel" id="panel-payment">
      <div class="sec-header"><div><h2>Payment Methods</h2><p>Manage accepted payment options</p></div><button class="btn btn-primary" onclick="openItemModal('payment',-1)">+ Add Method</button></div>
      <div class="card">
        <div class="card-title"><span class="dot"></span>Section Heading</div>
        <div class="form-grid">
          <div class="field"><label>Title</label><input id="f-paymentTitle" type="text"/></div>
          <div class="field"><label>Subtitle</label><input id="f-paymentSubtitle" type="text"/></div>
        </div>
        <div class="actions"><button class="btn btn-ghost btn-sm" onclick="saveHeading('paymentTitle','paymentSubtitle')">üíæ Save Heading</button></div>
      </div>
      <div class="card"><div class="card-title"><span class="dot"></span>Payment Items</div><div class="items-grid" id="payment-grid"></div></div>
    </div>

    <!-- PRODUCTS -->
    <div class="section-panel" id="panel-products">
      <div class="sec-header"><div><h2>Products Shop</h2><p>Products with price, image & buy link</p></div><button class="btn btn-primary" onclick="openProductModal(-1)">+ Add Product</button></div>
      <div class="card">
        <div class="card-title"><span class="dot"></span>Section Heading</div>
        <div class="form-grid">
          <div class="field"><label>Title</label><input id="f-productsTitle" type="text" placeholder="Our Products"/></div>
          <div class="field"><label>Subtitle</label><input id="f-productsSubtitle" type="text" placeholder="Shop Now"/></div>
        </div>
        <div class="actions"><button class="btn btn-ghost btn-sm" onclick="saveHeading('productsTitle','productsSubtitle')">üíæ Save Heading</button></div>
      </div>
      <div class="card"><div class="card-title"><span class="dot"></span>Products</div><div class="items-grid" id="products-grid"></div></div>
    </div>

    <!-- CUSTOM SECTIONS -->
    <div class="section-panel" id="panel-custom-sections">
      <div class="sec-header"><div><h2>Custom Sections</h2><p>Add extra content blocks (FAQ, Testimonials, etc.)</p></div><button class="btn btn-primary" onclick="openCustomSecModal(-1)">+ Add Section</button></div>
      <div class="card"><div class="card-title"><span class="dot"></span>Custom Sections</div><div id="custom-sec-list"></div></div>
    </div>

    <!-- SOCIAL -->
    <div class="section-panel" id="panel-social">
      <div class="sec-header"><div><h2>Social Links</h2><p>Your social media URLs</p></div><button class="btn btn-primary" onclick="saveSocial()">üíæ Save All</button></div>
      <div class="card">
        <div class="card-title"><span class="dot"></span>Social Media</div>
        <div class="social-row"><div class="social-icon si-fb">f</div><span class="social-name">Facebook</span><input id="s-facebook" type="url" placeholder="https://facebook.com/..."/></div>
        <div class="social-row"><div class="social-icon si-ig">üì∑</div><span class="social-name">Instagram</span><input id="s-instagram" type="url" placeholder="https://instagram.com/..."/></div>
        <div class="social-row"><div class="social-icon si-yt">‚ñ∂</div><span class="social-name">YouTube</span><input id="s-youtube" type="url" placeholder="https://youtube.com/..."/></div>
        <div class="social-row"><div class="social-icon si-gp" style="font-size:11px;font-weight:800;">G+</div><span class="social-name">Google</span><input id="s-googleplus" type="url" placeholder="https://google.com/..."/></div>
        <div class="social-row"><div class="social-icon si-tw">üê¶</div><span class="social-name">Twitter / X</span><input id="s-twitter" type="url" placeholder="https://twitter.com/..."/></div>
        <div class="social-row"><div class="social-icon si-li">in</div><span class="social-name">LinkedIn</span><input id="s-linkedin" type="url" placeholder="https://linkedin.com/..."/></div>
      </div>
    </div>

    <!-- ENQUIRIES -->
    <div class="section-panel" id="panel-enquiries">
      <div class="sec-header"><div><h2>Enquiries</h2><p>Messages from your contact form</p></div>
        <div style="display:flex;gap:10px;">
          <button class="btn btn-ghost btn-sm" onclick="markAllRead()">‚úì Mark All Read</button>
          <button class="btn btn-danger btn-sm" onclick="clearAllEnq()">üóëÔ∏è Clear All</button>
        </div>
      </div>
      <div class="card"><div class="card-title"><span class="dot dot-red"></span>Messages</div>
        <div style="overflow-x:auto;">
          <table class="eq-table">
            <thead><tr><th>Name</th><th>Email</th><th>Phone</th><th>Subject</th><th>Message</th><th>Date</th><th>Status</th><th></th></tr></thead>
            <tbody id="eq-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- APPEARANCE -->
    <div class="section-panel" id="panel-appearance">
      <div class="sec-header"><div><h2>Appearance</h2><p>Section visibility and color themes</p></div><button class="btn btn-primary" onclick="saveAppearance()">üíæ Save</button></div>
      <div class="card">
        <div class="card-title"><span class="dot"></span>Accent Color</div>
        <div class="color-row"><label>Button & Link Color</label><input type="color" id="f-accentColor" value="#5b8cff"/><span id="accent-hex" style="font-family:'DM Mono';font-size:12px;color:var(--text3);">#5b8cff</span></div>
      </div>
      <div class="card">
        <div class="card-title"><span class="dot"></span>Section Visibility</div>
        <div class="toggle-row"><div class="ti"><h4>About</h4><p>About Us section</p></div><label class="toggle"><input type="checkbox" id="t-showAbout" checked/><span class="slider"></span></label></div>
        <div class="toggle-row"><div class="ti"><h4>Services</h4><p>Services / Menu grid</p></div><label class="toggle"><input type="checkbox" id="t-showService" checked/><span class="slider"></span></label></div>
        <div class="toggle-row"><div class="ti"><h4>Gallery</h4><p>Photo gallery</p></div><label class="toggle"><input type="checkbox" id="t-showGallery" checked/><span class="slider"></span></label></div>
        <div class="toggle-row"><div class="ti"><h4>Videos</h4><p>YouTube / local videos</p></div><label class="toggle"><input type="checkbox" id="t-showVideo" checked/><span class="slider"></span></label></div>
        <div class="toggle-row"><div class="ti"><h4>Payment</h4><p>Payment methods</p></div><label class="toggle"><input type="checkbox" id="t-showPayment" checked/><span class="slider"></span></label></div>
        <div class="toggle-row"><div class="ti"><h4>Products Shop</h4><p>Products with buy links</p></div><label class="toggle"><input type="checkbox" id="t-showProducts"/><span class="slider"></span></label></div>
        <div class="toggle-row"><div class="ti"><h4>Enquiry Form</h4><p>Contact / booking form</p></div><label class="toggle"><input type="checkbox" id="t-showEnquiry" checked/><span class="slider"></span></label></div>
        <div class="toggle-row"><div class="ti"><h4>View Counter</h4></div><label class="toggle"><input type="checkbox" id="t-showViewCounter" checked/><span class="slider"></span></label></div>
        <div class="toggle-row"><div class="ti"><h4>Particles Background</h4></div><label class="toggle"><input type="checkbox" id="t-showParticles" checked/><span class="slider"></span></label></div>
        <div class="toggle-row"><div class="ti"><h4>Theme Toggle</h4></div><label class="toggle"><input type="checkbox" id="t-showThemeToggle" checked/><span class="slider"></span></label></div>
      </div>
      <div class="actions"><button class="btn btn-primary" onclick="saveAppearance()">üíæ Save Appearance</button></div>
    </div>

    <!-- SETTINGS -->
    <div class="section-panel" id="panel-settings">
      <div class="sec-header"><div><h2>Settings</h2><p>Credentials, SEO, and data management</p></div></div>
      <div class="card">
        <div class="card-title"><span class="dot"></span>View Counter</div>
        <div class="form-grid"><div class="field"><label>Display Value</label><input id="f-viewCount" type="text" placeholder="1,000"/></div></div>
        <div class="actions">
          <button class="btn btn-ghost btn-sm" onclick="saveField('viewCount','f-viewCount')">üíæ Save</button>
          <button class="btn btn-danger btn-sm" onclick="resetViews()">‚Ü∫ Reset to 0</button>
        </div>
      </div>
      <div class="card">
        <div class="card-title"><span class="dot"></span>SEO & Meta</div>
        <div class="form-grid full">
          <div class="field"><label>Page Title</label><input id="f-metaTitle" type="text"/></div>
          <div class="field"><label>Meta Description</label><textarea id="f-metaDesc" style="min-height:80px;"></textarea></div>
        </div>
        <div class="actions"><button class="btn btn-primary" onclick="saveSEO()">üíæ Save SEO</button></div>
      </div>
      <div class="card">
        <div class="card-title"><span class="dot dot-red"></span>Change Password</div>
        <div class="form-grid">
          <div class="field"><label>Current Password</label><input type="password" id="pw-current"/></div>
          <div class="field"><label>New Password</label><input type="password" id="pw-new"/></div>
        </div>
        <div class="actions"><button class="btn btn-primary" onclick="changePassword()">üîí Update Password</button></div>
      </div>
      <div class="card">
        <div class="card-title"><span class="dot dot-red"></span>Danger Zone</div>
        <div class="toggle-row"><div class="ti"><h4>Reset All Content</h4><p>Clears all your changes and restores defaults</p></div><button class="btn btn-danger btn-sm" onclick="resetAll()">Reset Everything</button></div>
        <div class="toggle-row"><div class="ti"><h4>Export Data</h4><p>Download a JSON backup of all your content</p></div><button class="btn btn-ghost btn-sm" onclick="exportData()">‚¨áÔ∏è Export JSON</button></div>
      </div>
    </div>

  </div>
</div>

<!-- MODALS -->
<div class="modal-ov" id="item-modal">
  <div class="modal-box">
    <div class="modal-title" id="item-modal-title">Add Item</div>
    <div class="form-grid full" style="gap:16px;">
      <div class="field"><label>Title</label><input type="text" id="mi-title" placeholder="e.g. Web Design"/></div>
      <div class="field"><label>Image URL / Path</label><input type="text" id="mi-img" placeholder="assets/images/product.png"/></div>
      <div class="field"><label>üìÅ Upload Image</label>
        <div class="upload-area">
          <div class="upload-icon">üì∏</div><div class="upload-label">Click to upload</div>
          <input type="file" accept="image/*" onchange="handleImgUpload(this,'mi-img','mi-preview')"/>
        </div>
        <img id="mi-preview" class="upload-preview" src="" alt=""/>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeItemModal()">Cancel</button>
      <button class="btn btn-primary" id="item-modal-save">üíæ Save</button>
    </div>
  </div>
</div>

<div class="modal-ov" id="video-modal">
  <div class="modal-box">
    <div class="modal-title" id="vid-modal-title">Add Video</div>
    <div class="form-grid full" style="gap:16px;">
      <div class="field"><label>Video Title</label><input type="text" id="vi-title" placeholder="e.g. Company Tour"/></div>
      <div class="field"><label>YouTube Video ID (optional)</label><input type="text" id="vi-id" placeholder="e.g. dQw4w9WgXcQ"/><p style="font-size:11px;color:var(--text3);margin-top:4px;">The part after youtube.com/watch?v=</p></div>
      <div class="field"><label>üìπ Or Upload Local Video</label>
        <div class="upload-area">
          <div class="upload-icon">üé¨</div><div class="upload-label">MP4 / WebM (max 50MB)</div>
          <input type="file" accept="video/*" onchange="handleVideoUpload(this)"/>
        </div>
        <p id="video-file-name" style="font-size:11px;color:var(--text3);margin-top:6px;"></p>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeVideoModal()">Cancel</button>
      <button class="btn btn-primary" id="vid-modal-save">üíæ Save Video</button>
    </div>
  </div>
</div>

<div class="modal-ov" id="product-modal">
  <div class="modal-box" style="width:560px;">
    <div class="modal-title" id="prod-modal-title">Add Product</div>
    <div class="form-grid" style="gap:16px;">
      <div class="field"><label>Product Name</label><input type="text" id="pi-name" placeholder="e.g. Premium Package"/></div>
      <div class="field"><label>Price</label><input type="text" id="pi-price" placeholder="‚Çπ499"/></div>
      <div class="field" style="grid-column:1/-1"><label>Description</label><textarea id="pi-desc" style="min-height:70px;" placeholder="Brief description..."></textarea></div>
      <div class="field"><label>Image URL / Path</label><input type="text" id="pi-img" placeholder="assets/images/product.png"/></div>
      <div class="field"><label>üìÅ Upload Image</label>
        <div class="upload-area">
          <div class="upload-icon">üì∏</div><div class="upload-label">Click to upload</div>
          <input type="file" accept="image/*" onchange="handleImgUpload(this,'pi-img','pi-preview')"/>
        </div>
        <img id="pi-preview" class="upload-preview" src="" alt=""/>
      </div>
      <div class="field" style="grid-column:1/-1"><label>Buy Now Link</label><input type="url" id="pi-link" placeholder="https://yourstore.com/product"/></div>
      <div class="field" style="grid-column:1/-1"><label>Button Label</label><input type="text" id="pi-btn" placeholder="Buy Now" value="Buy Now"/></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeProductModal()">Cancel</button>
      <button class="btn btn-primary" id="prod-modal-save">üíæ Save Product</button>
    </div>
  </div>
</div>

<div class="modal-ov" id="custom-sec-modal">
  <div class="modal-box" style="width:560px;">
    <div class="modal-title" id="cs-modal-title">Add Custom Section</div>
    <div class="form-grid full" style="gap:16px;">
      <div class="field"><label>Section Title</label><input type="text" id="cs-title" placeholder="e.g. Our Story, FAQ, Certificates..."/></div>
      <div class="field"><label>Subtitle (optional)</label><input type="text" id="cs-subtitle" placeholder="Tagline or sub-heading"/></div>
      <div class="field"><label>Content</label><textarea id="cs-content" style="min-height:140px;" placeholder="Write your content here..."></textarea></div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div class="field"><label>Image URL</label><input type="text" id="cs-img" placeholder="URL or path (optional)"/></div>
        <div class="field"><label>üìÅ Upload Image</label>
          <div class="upload-area">
            <div class="upload-icon">üì∏</div><div class="upload-label">Click to upload</div>
            <input type="file" accept="image/*" onchange="handleImgUpload(this,'cs-img','cs-preview')"/>
          </div>
          <img id="cs-preview" class="upload-preview" src="" alt=""/>
        </div>
        <div class="field"><label>Button Label</label><input type="text" id="cs-btn-label" placeholder="Learn More (optional)"/></div>
        <div class="field"><label>Button Link</label><input type="url" id="cs-btn-link" placeholder="https://..."/></div>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeCustomSecModal()">Cancel</button>
      <button class="btn btn-primary" id="cs-modal-save">üíæ Save Section</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"><div class="toast-dot"></div><span id="toast-msg">Saved!</span></div>

<script>
'use strict';
var STORE_KEY='vcardAdminData',ENQ_KEY='vcardEnquiries',AUTH_KEY='vcardAdminCreds',TPL_KEY='vcardActiveTemplate';

var TEMPLATES=[
  {id:'luxury',name:'üíé Luxury Gold',file:'template-luxury.html',preview:'linear-gradient(135deg,#0a0a0f,#1a1428)',desc:'Dark luxury gold. Premium professionals.',tags:['Real Estate','Finance','CA','Doctor','Insurance']},
  {id:'glam',name:'üíÑ Pink Glam',file:'template-glam.html',preview:'linear-gradient(135deg,#e91e8c,#ff9dcb)',desc:'Soft pink feminine design. Beauty pros.',tags:['Salon','Makeup Artist','Mehendi','Hair Stylist']},
  {id:'energy',name:'üí™ Energy Green',file:'template-energy.html',preview:'linear-gradient(135deg,#0a1a0a,#1a3a1a)',desc:'Bold dark green athletic. Fitness & coaching.',tags:['Gym Trainer','Yoga','Personal Coach','Speaker']},
  {id:'urban',name:'üîß Urban Orange',file:'template-urban.html',preview:'linear-gradient(135deg,#ff6b35,#ff9a6c)',desc:'Clean bold orange. Local service pros.',tags:['Electrician','Plumber','Interior Designer','CCTV']},
  {id:'food',name:'üçΩÔ∏è Food & Flavour',file:'template-food.html',preview:'linear-gradient(135deg,#d32f2f,#ff8f00)',desc:'Warm red & amber. Food businesses.',tags:['Cafe','Cloud Kitchen','Caterer','Sweet Shop']},
  {id:'digital',name:'üöÄ Digital Creator',file:'template-digital.html',preview:'linear-gradient(135deg,#7c3aed,#06b6d4)',desc:'Purple-cyan futuristic. Digital creators.',tags:['YouTuber','Influencer','Digital Marketer','Affiliate']}
];

var DEFAULT_DATA={
  businessName:'Business Name',ownerName:'Owner Name',bizPosition:'Business Position',personType:'',
  profileImg:'assets/images/profile.png',phone:'+91 98765 43210',email:'demo@gmail.com',fax:'022-12345678',
  address:'Mumbai, Maharashtra 400001',mapsUrl:'https://maps.google.com',websiteUrl:'#',whatsappShareUrl:'#',
  aboutTitle:'About Us',aboutSubtitle:'Know More',
  aboutPara1:'We are a professional team dedicated to delivering excellent services. With years of experience, we bring quality, trust, and expertise to everything we do.',
  aboutPara2:'Our commitment to customer satisfaction sets us apart. Feel free to reach out ‚Äî we are always ready to help.',
  serviceTitle:'Services',serviceSubtitle:'What We Offer',
  galleryTitle:'Gallery',gallerySubtitle:'Our Work',
  videoTitle:'Videos',videoSubtitle:'Watch Us',
  paymentTitle:'Payment',paymentSubtitle:'We Accept',
  productsTitle:'Our Products',productsSubtitle:'Shop Now',
  socialFacebook:'#',socialInstagram:'#',socialYoutube:'#',socialGoogleplus:'#',socialTwitter:'#',socialLinkedin:'#',
  showAbout:true,showService:true,showGallery:true,showVideo:true,showPayment:true,showEnquiry:true,
  showProducts:false,showViewCounter:true,showParticles:true,showThemeToggle:true,
  viewCount:'1,000',accentColor:'',metaTitle:'',metaDesc:'',
  services:[{title:'Service 1',img:'assets/images/product.png'},{title:'Service 2',img:'assets/images/product.png'},{title:'Service 3',img:'assets/images/product.png'},{title:'Service 4',img:'assets/images/product.png'}],
  gallery:[{img:'assets/images/gallery.png'},{img:'assets/images/gallery.png'},{img:'assets/images/gallery.png'},{img:'assets/images/gallery.png'},{img:'assets/images/gallery.png'},{img:'assets/images/gallery.png'}],
  videos:[{id:'dQw4w9WgXcQ',title:'Welcome Video'}],
  payment:[{title:'Cash',img:'assets/images/payment.png'},{title:'UPI',img:'assets/images/payment.png'},{title:'Card',img:'assets/images/payment.png'}],
  products:[],customSections:[]
};

var adminData={};
var itemModalCtx={type:'',idx:-1};
var vidEditIdx=-1, prodEditIdx=-1, csEditIdx=-1;
var uploadedVideoDataUrl=null;

function f(id){return document.getElementById(id);}
function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}

function loadData(){
  var saved={};try{saved=JSON.parse(localStorage.getItem(STORE_KEY))||{};}catch(e){}
  adminData=Object.assign({},DEFAULT_DATA,saved);
  ['services','gallery','videos','payment','products','customSections'].forEach(function(k){
    if(saved[k])adminData[k]=JSON.parse(JSON.stringify(saved[k]));
    else adminData[k]=JSON.parse(JSON.stringify(DEFAULT_DATA[k]));
  });
}
function saveData(){localStorage.setItem(STORE_KEY,JSON.stringify(adminData));}

// AUTH
function getCreds(){var c={};try{c=JSON.parse(localStorage.getItem(AUTH_KEY))||{};}catch(e){}return{user:c.user||'admin',pass:c.pass||'admin123'};}
function doLogin(){
  var u=f('lu').value.trim(),p=f('lp').value,c=getCreds();
  if(u===c.user&&p===c.pass){f('login-screen').classList.add('hidden');toast('Welcome back! üëã');}
  else{f('lu').style.borderColor='var(--accent2)';f('lp').style.borderColor='var(--accent2)';setTimeout(function(){f('lu').style.borderColor='';f('lp').style.borderColor='';},1500);}
}
function doLogout(){f('login-screen').classList.remove('hidden');f('lu').value='';f('lp').value='';}
function changePassword(){
  var cur=f('pw-current').value,nw=f('pw-new').value,c=getCreds();
  if(cur!==c.pass){toast('‚ùå Wrong current password');return;}
  if(!nw||nw.length<4){toast('‚ùå Min 4 characters');return;}
  localStorage.setItem(AUTH_KEY,JSON.stringify({user:c.user,pass:nw}));
  f('pw-current').value='';f('pw-new').value='';
  toast('‚úÖ Password updated');
}
f('lp').addEventListener('keydown',function(e){if(e.key==='Enter')doLogin();});

// TOAST
var toastT;
function toast(msg){clearTimeout(toastT);f('toast-msg').textContent=msg;f('toast').classList.add('show');toastT=setTimeout(function(){f('toast').classList.remove('show');},3000);}

// NAV
var pageTitles={dashboard:'Dashboard',templates:'Choose Template',profile:'Profile & Home',about:'About Us',services:'Services',gallery:'Gallery',videos:'Videos',payment:'Payment Methods',products:'Products Shop','custom-sections':'Custom Sections',social:'Social Links',enquiries:'Enquiries',appearance:'Appearance',settings:'Settings'};
document.querySelectorAll('.nav-item').forEach(function(el){
  el.addEventListener('click',function(){
    var panel=this.getAttribute('data-panel');
    document.querySelectorAll('.section-panel').forEach(function(p){p.classList.remove('active');});
    document.querySelectorAll('.nav-item').forEach(function(n){n.classList.remove('active');});
    var pp=f('panel-'+panel);if(pp)pp.classList.add('active');
    this.classList.add('active');
    f('page-title').textContent=pageTitles[panel]||panel;
    if(panel==='enquiries')renderEnquiries();
    if(panel==='dashboard')updateDashboard();
  });
});

// TEMPLATES
function getActiveTpl(){return localStorage.getItem(TPL_KEY)||'luxury';}
function setActiveTpl(id){
  localStorage.setItem(TPL_KEY,id);
  var tpl=TEMPLATES.find(function(t){return t.id===id;});
  if(tpl){f('preview-link').href=tpl.file;}
  renderTemplates();updateDashboard();
  toast('‚úÖ Template switched! Click "View Site" to see it.');
}
function renderTemplates(){
  var active=getActiveTpl(),grid=f('tpl-grid');if(!grid)return;
  grid.innerHTML=TEMPLATES.map(function(tpl){
    var isActive=tpl.id===active;
    return '<div class="tpl-card'+(isActive?' selected':'')+'">'+
      '<div class="tpl-preview" style="background:'+tpl.preview+'"><span style="font-size:50px;">'+tpl.name.split(' ')[0]+'</span></div>'+
      '<div class="tpl-info">'+
        '<div class="tpl-name">'+esc(tpl.name)+'</div>'+
        '<div class="tpl-desc">'+esc(tpl.desc)+'</div>'+
        '<div class="tpl-tags">'+tpl.tags.map(function(t){return '<span class="tpl-tag">'+esc(t)+'</span>';}).join('')+'</div>'+
        '<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px;">'+
          '<button class="btn btn-sm '+(isActive?'btn-ghost':'btn-primary')+'" onclick="setActiveTpl(\''+tpl.id+'\')">'+(isActive?'‚úì Active':'Use This')+'</button>'+
          '<a class="btn btn-sm btn-ghost" href="'+esc(tpl.file)+'" target="_blank" style="text-align:center;text-decoration:none;">Preview</a>'+
        '</div>'+
      '</div></div>';
  }).join('');
}

// DASHBOARD
function updateDashboard(){
  var enqList=[];try{enqList=JSON.parse(localStorage.getItem(ENQ_KEY))||[];}catch(e){}
  f('d-views').textContent=adminData.viewCount||'0';
  f('d-enq').textContent=enqList.length;
  f('d-svc').textContent=(adminData.services||[]).length;
  f('d-gal').textContent=(adminData.gallery||[]).length;
  f('d-prod').textContent=(adminData.products||[]).length;
  f('d-cs').textContent=(adminData.customSections||[]).length;
  var newCount=enqList.filter(function(e){return e.status==='new';}).length;
  var badge=f('eq-badge');if(badge){badge.textContent=newCount;badge.style.display=newCount?'':'none';}
  // Chart bars
  var bars=f('chart-bars');
  if(bars){var heights=[30,55,40,70,90,65,80];bars.innerHTML=heights.map(function(h){return '<div class="chart-bar" style="height:'+h+'%"></div>';}).join('');}
  // Template info
  var active=getActiveTpl();var tpl=TEMPLATES.find(function(t){return t.id===active;})||TEMPLATES[0];
  f('preview-link').href=tpl.file;
  var info=f('dash-template-info');
  if(info)info.innerHTML='<div style="font-size:28px;margin-bottom:8px;">'+tpl.name.split(' ')[0]+'</div><div style="font-weight:600;color:var(--text);">'+esc(tpl.name)+'</div><div style="font-size:12px;color:var(--text3);margin-top:4px;">'+esc(tpl.desc)+'</div>';
}

// POPULATE FORMS
function populateForms(){
  ['businessName','ownerName','bizPosition','personType','profileImg','phone','email','fax','address','mapsUrl','websiteUrl','whatsappShareUrl','aboutTitle','aboutSubtitle','aboutPara1','aboutPara2','serviceTitle','serviceSubtitle','galleryTitle','gallerySubtitle','videoTitle','videoSubtitle','paymentTitle','paymentSubtitle','productsTitle','productsSubtitle','viewCount','metaTitle','metaDesc','accentColor'].forEach(function(k){
    var el=f('f-'+k);if(el&&adminData[k]!==undefined)el.value=adminData[k];
  });
  var soc={facebook:'socialFacebook',instagram:'socialInstagram',youtube:'socialYoutube',googleplus:'socialGoogleplus',twitter:'socialTwitter',linkedin:'socialLinkedin'};
  Object.keys(soc).forEach(function(k){var el=f('s-'+k);if(el)el.value=adminData[soc[k]]||'';});
  ['showAbout','showService','showGallery','showVideo','showPayment','showProducts','showEnquiry','showViewCounter','showParticles','showThemeToggle'].forEach(function(k){var el=f('t-'+k);if(el)el.checked=adminData[k]!==false;});
  var ac=f('f-accentColor');if(ac){ac.addEventListener('input',function(){f('accent-hex').textContent=this.value;});if(adminData.accentColor)ac.value=adminData.accentColor;}
  renderAllGrids();renderTemplates();updateDashboard();
}

// RENDER GRIDS
function renderAllGrids(){renderGrid('services');renderGrid('gallery');renderGrid('payment');renderProductsGrid();renderVideos();renderCustomSecs();}

function renderGrid(type){
  var arr=adminData[type]||[];
  var labels={services:'services',gallery:'gallery',payment:'payment'};
  var gid={services:'services-grid',gallery:'gallery-grid',payment:'payment-grid'}[type];
  var g=f(gid);if(!g)return;
  var html=arr.map(function(item,i){
    var img=item.img;
    return '<div class="item-card">'+
      '<div class="item-img-wrap">'+(img?'<img src="'+esc(img)+'" alt=""/>':'üì∑')+'</div>'+
      '<div class="item-body"><div class="item-title">'+esc(item.title||'Image')+'</div>'+
      '<div class="item-btns">'+
        '<button class="edit-btn" onclick="openItemModal(\''+type+'\','+i+')">‚úèÔ∏è Edit</button>'+
        '<button class="del-btn" onclick="deleteItem(\''+type+'\','+i+')">üóëÔ∏è</button>'+
      '</div></div></div>';
  }).join('');
  html+='<div class="add-card" onclick="openItemModal(\''+type+'\',-1)"><div class="plus">+</div><div>Add '+type.slice(0,-1)+'</div></div>';
  g.innerHTML=html;
}

function renderProductsGrid(){
  var g=f('products-grid');if(!g)return;
  var html=(adminData.products||[]).map(function(item,i){
    var img=item.img;
    return '<div class="item-card">'+
      '<div class="item-img-wrap">'+(img?'<img src="'+esc(img)+'" alt=""/>':'üõí')+'</div>'+
      '<div class="item-body"><div class="item-title">'+esc(item.name)+'</div>'+
      '<div style="font-size:11px;color:var(--accent);font-family:\'DM Mono\';margin-bottom:8px;">'+esc(item.price||'')+'</div>'+
      '<div class="item-btns">'+
        '<button class="edit-btn" onclick="openProductModal('+i+')">‚úèÔ∏è Edit</button>'+
        '<button class="del-btn" onclick="deleteProduct('+i+')">üóëÔ∏è</button>'+
      '</div></div></div>';
  }).join('');
  html+='<div class="add-card" onclick="openProductModal(-1)"><div class="plus">+</div><div>Add Product</div></div>';
  g.innerHTML=html;
}

function renderVideos(){
  var g=f('videos-list');if(!g)return;
  if(!adminData.videos||!adminData.videos.length){g.innerHTML='<div style="text-align:center;padding:24px;color:var(--text3);">No videos yet. Add your first video.</div>';return;}
  g.innerHTML=adminData.videos.map(function(v,i){
    var thumb=v.localSrc?'üé¨':('https://img.youtube.com/vi/'+v.id+'/mqdefault.jpg');
    return '<div class="custom-sec-card">'+
      '<div style="width:70px;height:44px;border-radius:6px;overflow:hidden;flex-shrink:0;background:var(--surface);display:flex;align-items:center;justify-content:center;">'+(v.localSrc?'<span style="font-size:22px;">üé¨</span>':'<img src="'+esc(thumb)+'" style="width:100%;height:100%;object-fit:cover;"/>')+'</div>'+
      '<div class="custom-sec-info"><div class="custom-sec-title">'+esc(v.title||'Video')+'</div>'+
        '<div class="custom-sec-preview">'+(v.localSrc?'Local video file':'YouTube: '+esc(v.id))+'</div></div>'+
      '<div style="display:flex;gap:6px;flex-shrink:0;">'+
        '<button class="edit-btn" onclick="openVideoModal('+i+')">‚úèÔ∏è</button>'+
        '<button class="del-btn" onclick="deleteVideo('+i+')">üóëÔ∏è</button>'+
      '</div></div>';
  }).join('');
}

function renderCustomSecs(){
  var g=f('custom-sec-list');if(!g)return;
  if(!adminData.customSections||!adminData.customSections.length){g.innerHTML='<div style="text-align:center;padding:32px;color:var(--text3);">üì≠ No custom sections yet. Add FAQ, testimonials, certificates, etc.</div>';return;}
  g.innerHTML=adminData.customSections.map(function(sec,i){
    return '<div class="custom-sec-card">'+
      '<div class="custom-sec-num">'+(i+1)+'</div>'+
      '<div class="custom-sec-info"><div class="custom-sec-title">'+esc(sec.title)+'</div>'+
        '<div class="custom-sec-preview">'+esc((sec.content||'').substring(0,60))+(sec.content&&sec.content.length>60?'...':'')+'</div></div>'+
      '<div style="display:flex;gap:6px;flex-shrink:0;">'+
        '<button class="edit-btn" onclick="openCustomSecModal('+i+')">‚úèÔ∏è</button>'+
        '<button class="del-btn" onclick="deleteCustomSec('+i+')">üóëÔ∏è</button>'+
      '</div></div>';
  }).join('');
}

// SAVE SECTIONS
function saveSection(s){
  if(s==='profile'){
    ['businessName','ownerName','bizPosition','personType','profileImg','phone','email','fax','address','mapsUrl','websiteUrl','whatsappShareUrl'].forEach(function(k){var el=f('f-'+k);if(el)adminData[k]=el.value;});
    saveData();toast('‚úÖ Profile saved');
  }
  if(s==='about'){
    ['aboutTitle','aboutSubtitle','aboutPara1','aboutPara2'].forEach(function(k){var el=f('f-'+k);if(el)adminData[k]=el.value;});
    saveData();toast('‚úÖ About saved');
  }
}
function saveHeading(k1,k2){
  var e1=f('f-'+k1),e2=f('f-'+k2);
  if(e1)adminData[k1]=e1.value;
  if(e2)adminData[k2]=e2.value;
  saveData();toast('‚úÖ Heading saved');
}
function saveSocial(){
  var map={facebook:'socialFacebook',instagram:'socialInstagram',youtube:'socialYoutube',googleplus:'socialGoogleplus',twitter:'socialTwitter',linkedin:'socialLinkedin'};
  Object.keys(map).forEach(function(k){var el=f('s-'+k);if(el)adminData[map[k]]=el.value;});
  saveData();toast('‚úÖ Social links saved');
}
function saveAppearance(){
  ['showAbout','showService','showGallery','showVideo','showPayment','showProducts','showEnquiry','showViewCounter','showParticles','showThemeToggle'].forEach(function(k){var el=f('t-'+k);if(el)adminData[k]=el.checked;});
  var ac=f('f-accentColor');if(ac)adminData.accentColor=ac.value;
  saveData();toast('‚úÖ Appearance saved');
}
function saveSEO(){
  ['metaTitle','metaDesc'].forEach(function(k){var el=f('f-'+k);if(el)adminData[k]=el.value;});
  saveData();toast('‚úÖ SEO saved');
}
function saveField(key,fid){var el=f(fid);if(el){adminData[key]=el.value;saveData();toast('‚úÖ Saved');}}
function resetViews(){adminData.viewCount='0';saveData();var el=f('f-viewCount');if(el)el.value='0';toast('‚úÖ Views reset');}
function resetAll(){if(!confirm('Reset ALL content? This cannot be undone.'))return;localStorage.removeItem(STORE_KEY);loadData();populateForms();toast('‚úÖ Reset done');}
function exportData(){var blob=new Blob([JSON.stringify(adminData,null,2)],{type:'application/json'});var a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='vcard-backup-'+Date.now()+'.json';a.click();toast('‚úÖ Exported');}

// IMAGE UPLOAD
function handleImgUpload(input,targetId,previewId){
  var file=input.files[0];if(!file)return;
  if(file.size>5*1024*1024){toast('‚ùå Image too large (max 5MB)');return;}
  var reader=new FileReader();
  reader.onload=function(e){
    var el=f(targetId);if(el)el.value=e.target.result;
    var pv=f(previewId);if(pv){pv.src=e.target.result;pv.classList.add('show');}
  };
  reader.readAsDataURL(file);
}
function handleVideoUpload(input){
  var file=input.files[0];if(!file)return;
  if(file.size>50*1024*1024){toast('‚ùå Video too large (max 50MB)');return;}
  var reader=new FileReader();
  reader.onload=function(e){
    uploadedVideoDataUrl=e.target.result;
    var fn=f('video-file-name');if(fn)fn.textContent='‚úÖ Loaded: '+file.name;
  };
  reader.readAsDataURL(file);
}

// ITEM MODAL (services, gallery, payment)
function openItemModal(type,idx){
  itemModalCtx={type:type,idx:idx};
  var labels={services:'Service',gallery:'Gallery Image',payment:'Payment Method'};
  var lbl=labels[type]||'Item';
  f('item-modal-title').textContent=(idx>=0?'Edit ':'Add ')+lbl;
  var item=(idx>=0&&adminData[type]&&adminData[type][idx])||{};
  f('mi-title').value=item.title||'';
  f('mi-img').value=item.img||'';
  var pv=f('mi-preview');if(pv){pv.src=item.img||'';pv.classList[item.img?'add':'remove']('show');}
  f('item-modal').classList.add('show');
  f('item-modal-save').onclick=saveItemModal;
}
function saveItemModal(){
  var ctx=itemModalCtx;
  if(!adminData[ctx.type])adminData[ctx.type]=[];
  var item={title:f('mi-title').value,img:f('mi-img').value};
  if(ctx.idx>=0)adminData[ctx.type][ctx.idx]=item;
  else adminData[ctx.type].push(item);
  saveData();renderGrid(ctx.type);updateDashboard();closeItemModal();toast('‚úÖ Saved');
}
function closeItemModal(){f('item-modal').classList.remove('show');}
function deleteItem(type,idx){if(!confirm('Delete this item?'))return;adminData[type].splice(idx,1);saveData();renderGrid(type);updateDashboard();}

// VIDEO MODAL
function openVideoModal(idx){
  vidEditIdx=idx;uploadedVideoDataUrl=null;
  f('vid-modal-title').textContent=(idx>=0?'Edit':'Add')+' Video';
  var item=(idx>=0&&adminData.videos&&adminData.videos[idx])||{};
  f('vi-title').value=item.title||'';
  f('vi-id').value=item.id||'';
  f('video-file-name').textContent=item.localSrc?'‚úÖ Has local video':'';
  f('video-modal').classList.add('show');
  f('vid-modal-save').onclick=saveVideoModal;
}
function saveVideoModal(){
  if(!adminData.videos)adminData.videos=[];
  var item={title:f('vi-title').value,id:f('vi-id').value};
  if(uploadedVideoDataUrl){item.localSrc=uploadedVideoDataUrl;item.id='';}
  if(vidEditIdx>=0)adminData.videos[vidEditIdx]=item;
  else adminData.videos.push(item);
  saveData();renderVideos();closeVideoModal();toast('‚úÖ Video saved');
}
function closeVideoModal(){f('video-modal').classList.remove('show');}
function deleteVideo(idx){if(!confirm('Delete this video?'))return;adminData.videos.splice(idx,1);saveData();renderVideos();}

// PRODUCT MODAL
function openProductModal(idx){
  prodEditIdx=idx;
  f('prod-modal-title').textContent=(idx>=0?'Edit':'Add')+' Product';
  var item=(idx>=0&&adminData.products&&adminData.products[idx])||{};
  f('pi-name').value=item.name||'';
  f('pi-price').value=item.price||'';
  f('pi-desc').value=item.desc||'';
  f('pi-img').value=item.img||'';
  f('pi-link').value=item.link||'';
  f('pi-btn').value=item.btn||'Buy Now';
  var pv=f('pi-preview');if(pv){pv.src=item.img||'';pv.classList[item.img?'add':'remove']('show');}
  f('product-modal').classList.add('show');
  f('prod-modal-save').onclick=saveProductModal;
}
function saveProductModal(){
  if(!adminData.products)adminData.products=[];
  var item={name:f('pi-name').value,price:f('pi-price').value,desc:f('pi-desc').value,img:f('pi-img').value,link:f('pi-link').value,btn:f('pi-btn').value||'Buy Now'};
  if(prodEditIdx>=0)adminData.products[prodEditIdx]=item;
  else adminData.products.push(item);
  saveData();renderProductsGrid();updateDashboard();closeProductModal();toast('‚úÖ Product saved');
}
function closeProductModal(){f('product-modal').classList.remove('show');}
function deleteProduct(idx){if(!confirm('Delete this product?'))return;adminData.products.splice(idx,1);saveData();renderProductsGrid();updateDashboard();}

// CUSTOM SECTION MODAL
function openCustomSecModal(idx){
  csEditIdx=idx;
  f('cs-modal-title').textContent=(idx>=0?'Edit':'Add')+' Custom Section';
  var item=(idx>=0&&adminData.customSections&&adminData.customSections[idx])||{};
  f('cs-title').value=item.title||'';
  f('cs-subtitle').value=item.subtitle||'';
  f('cs-content').value=item.content||'';
  f('cs-img').value=item.img||'';
  f('cs-btn-label').value=item.btnLabel||'';
  f('cs-btn-link').value=item.btnLink||'';
  var pv=f('cs-preview');if(pv){pv.src=item.img||'';pv.classList[item.img?'add':'remove']('show');}
  f('custom-sec-modal').classList.add('show');
  f('cs-modal-save').onclick=saveCustomSecModal;
}
function saveCustomSecModal(){
  if(!adminData.customSections)adminData.customSections=[];
  var item={title:f('cs-title').value,subtitle:f('cs-subtitle').value,content:f('cs-content').value,img:f('cs-img').value,btnLabel:f('cs-btn-label').value,btnLink:f('cs-btn-link').value};
  if(csEditIdx>=0)adminData.customSections[csEditIdx]=item;
  else adminData.customSections.push(item);
  saveData();renderCustomSecs();updateDashboard();closeCustomSecModal();toast('‚úÖ Section saved');
}
function closeCustomSecModal(){f('custom-sec-modal').classList.remove('show');}
function deleteCustomSec(idx){if(!confirm('Delete this section?'))return;adminData.customSections.splice(idx,1);saveData();renderCustomSecs();updateDashboard();}

// ENQUIRIES
function renderEnquiries(){
  var list=[];try{list=JSON.parse(localStorage.getItem(ENQ_KEY))||[];}catch(e){}
  var tb=f('eq-tbody');if(!tb)return;
  if(!list.length){tb.innerHTML='<tr><td colspan="8" style="text-align:center;padding:32px;color:var(--text3);">üì≠ No enquiries yet.</td></tr>';return;}
  tb.innerHTML=list.map(function(eq,i){
    return '<tr><td>'+esc(eq.name||'')+'</td><td>'+esc(eq.email||'')+'</td><td>'+esc(eq.phone||'')+'</td><td>'+esc(eq.subject||'')+'</td>'+
      '<td style="max-width:160px;white-space:normal;">'+esc((eq.message||'').substring(0,80))+'</td>'+
      '<td style="white-space:nowrap;">'+esc(eq.date||'')+'</td>'+
      '<td><span class="'+(eq.status==='new'?'s-new':'s-read')+'">'+esc(eq.status||'new')+'</span></td>'+
      '<td><button class="del-btn" onclick="deleteEnq('+i+')">üóëÔ∏è</button></td></tr>';
  }).join('');
}
function markAllRead(){
  var list=[];try{list=JSON.parse(localStorage.getItem(ENQ_KEY))||[];}catch(e){}
  list.forEach(function(eq){eq.status='read';});
  localStorage.setItem(ENQ_KEY,JSON.stringify(list));
  renderEnquiries();updateDashboard();toast('‚úÖ All marked read');
}
function deleteEnq(idx){
  var list=[];try{list=JSON.parse(localStorage.getItem(ENQ_KEY))||[];}catch(e){}
  list.splice(idx,1);localStorage.setItem(ENQ_KEY,JSON.stringify(list));
  renderEnquiries();updateDashboard();
}
function clearAllEnq(){
  if(!confirm('Delete ALL enquiries?'))return;
  localStorage.removeItem(ENQ_KEY);renderEnquiries();updateDashboard();toast('‚úÖ All cleared');
}

// CLOSE MODALS ON OVERLAY CLICK
['item-modal','video-modal','product-modal','custom-sec-modal'].forEach(function(id){
  var el=f(id);if(el)el.addEventListener('click',function(e){if(e.target===this)this.classList.remove('show');});
});

// INIT
loadData();populateForms();
</script>
</body>
</html>
